<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Santa</title>
</head>
<body>
    <h1>Secret Santa Generator</h1>

    <!-- Form to add participants -->
    <div id="setup">
        <h2>Enter Participants</h2>
        <form id="participantsForm">
            <input type="text" id="participantName" placeholder="Enter participant name" required>
            <button type="button" id="addParticipantButton">Add Participant</button>
        </form>

        <h3>Participants List:</h3>
        <ul id="participantsList"></ul>

        <button type="button" id="startButton">Start Secret Santa</button>
    </div>

    <!-- Display Secret Santa assignments -->
    <div id="play" class="hidden">
        <h2>Assignments:</h2>
        <ul id="assignmentsList"></ul>
    </div>

    <script>
let participants = [];

document.getElementById("addParticipantButton").addEventListener("click", function () {
    const nameInput = document.getElementById("participantName");
    const name = nameInput.value.trim();
    
    if (name) {
        participants.push({ name, assigned: null });
        updateParticipantsList();
    }
    
    // Clear the input field
    nameInput.value = "";
});

document.getElementById("startButton").addEventListener("click", function () {
    assignSecretSanta();
});

function updateParticipantsList() {
    const participantsList = document.getElementById("participantsList");
    participantsList.innerHTML = "";
    
    participants.forEach(p => {
        const li = document.createElement("li");
        li.textContent = p.name;
        participantsList.appendChild(li);
    });
}

function assignSecretSanta() {
    const maxAttempts = 10; // Maximum number of shuffling attempts
    let success = false;

    for (let attempt = 0; attempt < maxAttempts; attempt++) {
        // Clear previous assignments before each attempt
        participants.forEach(p => p.assigned = null);

        // Shuffle the participants to randomize assignment
        const recipients = [...participants].sort(() => Math.random() - 0.5);
        success = true;

        // Attempt to assign each participant a recipient
        for (let i = 0; i < participants.length; i++) {
            const santa = participants[i];
            const possibleRecipients = recipients.filter(p => 
                p.name !== santa.name &&  // Cannot assign to themselves
                p.assigned === null  // Ensure the recipient isn't already assigned
            );

            if (possibleRecipients.length === 0) {
                success = false;
                break; // Stop if we can't find a valid recipient for this Santa
            }

            // Randomly pick a recipient from the valid choices
            const recipient = possibleRecipients[Math.floor(Math.random() * possibleRecipients.length)];
            santa.assigned = recipient.name;
            recipient.assigned = true; // Mark recipient as assigned
        }

        if (success) {
            break; // Exit the loop if all participants are successfully assigned
        }
    }

    if (success) {
        alert("Secret Santa assignments complete!");
        document.getElementById("setup").classList.add("hidden");
        document.getElementById("play").classList.remove("hidden");

        // Show the assignments in the play section
        const assignmentsList = document.getElementById("assignmentsList");
        assignmentsList.innerHTML = "";
        
        participants.forEach(p => {
            const li = document.createElement("li");
            li.textContent = `${p.name} â†’ ${p.assigned}`;
            assignmentsList.appendChild(li);
        });
    } else {
        alert("Could not assign Secret Santas after multiple attempts. Try adjusting the participant list.");
    }
}
        // Reveal assignment based on player name entered
        function revealAssignment() {
            const playerName = document.getElementById("playerName").value.trim();
            const participant = participants.find(p => p.name.toLowerCase() === playerName.toLowerCase());

            if (participant && participant.assigned) {
                document.getElementById("assignmentResult").textContent = `Hello ${participant.name}, you are assigned to ${participant.assigned}.`;
            } else {
                document.getElementById("assignmentResult").textContent = "Name not found or no assignment available.";
            }
        }
    </script>

</body>
</html>
