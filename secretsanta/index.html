<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Secret Santa</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .hidden { display: none; }
        .form-group { margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1>Secret Santa Setup</h1>

    <div id="setup">
        <h2>Enter Participants</h2>
        <div id="participants"></div>
        <button onclick="addParticipant()">Add Participant</button>
        <button onclick="assignSecretSanta()">Assign Secret Santa</button>
    </div>

    <div id="play" class="hidden">
        <h2>Check Assignment</h2>
        <p>Enter your name to see your assigned Secret Santa recipient:</p>
        <input type="text" id="playerName" placeholder="Enter your name">
        <button onclick="revealAssignment()">See Assignment</button>
        <p id="assignmentResult"></p>
    </div>

    <script>
        let participants = [];

        // Add participant and optional significant other
        function addParticipant() {
            const name = prompt("Enter participant's name:");
            if (!name) return;

            const partner = prompt(`Enter ${name}'s significant other (leave blank if none):`);
            participants.push({ name, partner, assigned: null });
            renderParticipants();
        }

        // Display participants and their partners
        function renderParticipants() {
            const list = document.getElementById('participants');
            list.innerHTML = participants.map(p => `<div>${p.name} ${p.partner ? `(Partner: ${p.partner})` : ''}</div>`).join('');
        }

        // Shuffle and assign Secret Santas
function assignSecretSanta() {
    const maxAttempts = 10; // Maximum number of shuffling attempts
    let success = false;

    for (let attempt = 0; attempt < maxAttempts; attempt++) {
        // Clear previous assignments before each attempt
        participants.forEach(p => p.assigned = null);

        // Shuffle the participants to randomize assignment
        const recipients = [...participants].sort(() => Math.random() - 0.5);
        success = true;

        // Attempt to assign each participant a recipient
        for (let i = 0; i < participants.length; i++) {
            const santa = participants[i];

            // If no partner, don't check for partner constraints
            const possibleRecipients = recipients.filter(p => 
                p.name !== santa.name &&  // Cannot assign to themselves
                (!santa.partner || p.name !== santa.partner) &&  // If partner exists, exclude partner
                p.assigned === null  // Ensure the recipient isn't already assigned
            );

            if (possibleRecipients.length === 0) {
                success = false;
                break; // Stop if we can't find a valid recipient for this Santa
            }

            // Randomly pick a recipient from the valid choices
            const recipient = possibleRecipients[Math.floor(Math.random() * possibleRecipients.length)];
            santa.assigned = recipient.name;
            recipient.assigned = true; // Mark recipient as assigned
        }

        if (success) {
            break; // Exit the loop if all participants are successfully assigned
        }
    }

    if (success) {
        alert("Secret Santa assignments complete!");
        document.getElementById("setup").classList.add("hidden");
        document.getElementById("play").classList.remove("hidden");
    } else {
        alert("Could not assign Secret Santas without pairing issues after multiple attempts. Try adjusting the participant list or constraints.");
    }
}
        // Reveal assignment based on player name entered
        function revealAssignment() {
            const playerName = document.getElementById("playerName").value.trim();
            const participant = participants.find(p => p.name.toLowerCase() === playerName.toLowerCase());

            if (participant && participant.assigned) {
                document.getElementById("assignmentResult").textContent = `Hello ${participant.name}, you are assigned to ${participant.assigned}.`;
            } else {
                document.getElementById("assignmentResult").textContent = "Name not found or no assignment available.";
            }
        }
    </script>

</body>
</html>
