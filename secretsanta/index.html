<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secret Santa Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>Secret Santa Generator</h1>

    <!-- Form to add participants -->
    <div id="setup">
        <h2>Enter Participants</h2>
        <form id="participantsForm">
            <input type="text" id="participantName" placeholder="Enter participant name" required>
            <input type="text" id="partnerName" placeholder="Enter partner's name (optional)">
            <button type="button" id="addParticipantButton">Add Participant</button>
        </form>

        <h3>Participants List:</h3>
        <ul id="participantsList"></ul>

        <button type="button" id="startButton">Start Secret Santa</button>
    </div>

    <!-- Display Secret Santa assignments -->
    <div id="play" class="hidden">
        <h2>Assignments:</h2>
        <ul id="assignmentsList"></ul>

        <h3>Find Out Who You're Assigned To</h3>
        <input type="text" id="viewerName" placeholder="Enter your name to see your assignment">
        <button type="button" id="viewAssignmentButton">View Assignment</button>

        <div id="assignedPerson" class="hidden">
            <h4>You're assigned to: <span id="assignedName"></span></h4>
            <button type="button" id="backButton">Back</button>
        </div>
    </div>

    <script>
        let participants = [];

        // Add participant with optional partner
        document.getElementById("addParticipantButton").addEventListener("click", function () {
            const nameInput = document.getElementById("participantName");
            const partnerInput = document.getElementById("partnerName");

            const name = nameInput.value.trim();
            const partner = partnerInput.value.trim();

            if (name) {
                // Check if partner is provided, and link them automatically
                if (partner) {
                    participants.push({ name, partner, assigned: null });
                    participants.push({ name: partner, partner: name, assigned: null });
                } else {
                    participants.push({ name, partner: null, assigned: null });
                }
                updateParticipantsList();
            }

            // Clear the input fields
            nameInput.value = "";
            partnerInput.value = "";
        });

        // Start Secret Santa
        document.getElementById("startButton").addEventListener("click", function () {
            assignSecretSanta();
        });

        // Update participants list on UI
        function updateParticipantsList() {
            const participantsList = document.getElementById("participantsList");
            participantsList.innerHTML = "";

            participants.forEach(p => {
                const li = document.createElement("li");
                li.textContent = `${p.name} (Partner: ${p.partner || 'None'})`;
                participantsList.appendChild(li);
            });
        }

        // Assign Secret Santa while avoiding partners
        function assignSecretSanta() {
            let success = false;

            // Continue trying until assignments succeed
            while (!success) {
                // Clear previous assignments before each attempt
                participants.forEach(p => p.assigned = null);

                // Shuffle the participants to randomize assignment
                const shuffledParticipants = [...participants].sort(() => Math.random() - 0.5);
                success = true;

                // Attempt to assign each participant a recipient
                for (let i = 0; i < participants.length; i++) {
                    const santa = participants[i];
                    const recipient = shuffledParticipants[i];

                    // Ensure no one is assigned to themselves or their partner
                    if (santa.name === recipient.name || santa.partner === recipient.name) {
                        success = false;
                        break; // Restart if a participant is assigned to themselves or their partner
                    }

                    // Assign the recipient to the Santa
                    santa.assigned = recipient.name;
                }
            }

            // If the assignment was successful, display the results
            alert("Secret Santa assignments complete!");
            document.getElementById("setup").classList.add("hidden");
            document.getElementById("play").classList.remove("hidden");

            // Show the assignments in the play section
            const assignmentsList = document.getElementById("assignmentsList");
            assignmentsList.innerHTML = "";

            participants.forEach(p => {
                const li = document.createElement("li");
                li.textContent = `${p.name} â†’ ${p.assigned}`;
                assignmentsList.appendChild(li);
            });
        }

        // Show assigned person based on entered name
        document.getElementById("viewAssignmentButton").addEventListener("click", function () {
            const viewerName = document.getElementById("viewerName").value.trim();

            const participant = participants.find(p => p.name === viewerName);
            if (participant) {
                // Show assigned person
                document.getElementById("assignedName").textContent = participant.assigned;
                document.getElementById("assignedPerson").classList.remove("hidden");
            } else {
                alert("Name not found, please try again.");
            }
        });

        // Back button functionality
        document.getElementById("backButton").addEventListener("click", function () {
            document.getElementById("assignedPerson").classList.add("hidden");
            document.getElementById("viewerName").value = "";  // Clear the input
        });
    </script>
</body>
</html>
